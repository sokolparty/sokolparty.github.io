<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Storage</title>
    <script type="module">
        // Importuj funkcje Firebase
        import { initializeApp } from "firebase/app";
        import { getStorage, ref, uploadBytes, listAll, getDownloadURL } from "firebase/storage";

        // Konfiguracja Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyA_P1R1-PGfykAVM_Y9B6Ajz4ckkz1vz9Q",
            authDomain: "sokolparty420.firebaseapp.com",
            projectId: "sokolparty420",
            storageBucket: "sokolparty420.appspot.com",
            messagingSenderId: "361570196780",
            appId: "1:361570196780:web:e1e1e419d06d475355e089",
            measurementId: "G-18TK7X35TQ"
        };

        // Inicjalizacja Firebase
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        // Funkcja do przesyłania zdjęć
        async function uploadImage() {
            const file = document.getElementById('fileInput').files[0];
            if (!file) {
                alert('Proszę wybrać plik!');
                return;
            }
            const storageRef = ref(storage, 'uploads/' + file.name);
            try {
                await uploadBytes(storageRef, file);
                alert('Plik przesłany pomyślnie!');
                displayImages(); // Wywołaj funkcję do wyświetlania zdjęć
            } catch (error) {
                console.error('Błąd przesyłania:', error);
                alert('Błąd podczas przesyłania pliku: ' + error.message);
            }
        }

        // Funkcja do wyświetlania zdjęć
        async function displayImages() {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';

            const listRef = ref(storage, 'uploads/');
            const res = await listAll(listRef);
            res.items.forEach(async (itemRef) => {
                const url = await getDownloadURL(itemRef);
                const img = document.createElement('img');
                img.src = url;
                img.style.width = '200px';
                img.style.margin = '10px';
                gallery.appendChild(img);
            });
        }

        // Wywołaj funkcję wyświetlania zdjęć po załadowaniu strony
        window.onload = displayImages;
    </script>
</head>
<body>
    <h1>Przesyłanie zdjęć do Firebase Storage</h1>
    <input type="file" id="fileInput">
    <button onclick="uploadImage()">Prześlij zdjęcie</button>
    <div id="gallery"></div>
</body>
</html>
